{% extends "index.html.twig" %}
{% block title %}{{ parent() }} - Modifier {% endblock %}


{% block body %}
    <form method="post" action="/Utilisateur/Profile/Settings/" enctype="multipart/form-data">
        <div class="wall-white">

            <div class="nav-flex d-flex justify-content-between pt-2 px-2">
                <a href="/Home/" class="btn btn-fmm"><i class="fas fa-chevron-left"></i> Retour</a>
                <input type="submit" class="btn btn-fmm" value="Valider les modifications">
            </div>
            <div class="card cardd item-card" style="width: 30rem;">
                <div class="wrapper-img-profile">
                    <img class="card-img-top-fmm img"
                         src="/uploads/images/{{ userr.ProfilImgRepo }}/{{ userr.ProfilImgName }}" alt="Card image cap">
                </div>
                <div class="custom-file mx-auto mt-3 mb-1">
                    <input type="file" class="custom-file-input" id="mProfilImg" name="mProfilImg">
                    <label class="custom-file-label" for="mProfilImg" id="mProfilImg">Choisissez une photo de
                        profil</label>
                </div>
            </div>
            <div class="card cardd item-card" style="width: 30rem;">
                <div class="card-body">
                    <h5>{{ userr.Prenom }} {{ userr.Nom }}</h5>
                    <h6 class="text-muted">{{ userr.Age }} ans</h6>
                </div>
                <hr>
                <div class="card-body">
                    <input type="text" name="mTitre" class="form-control mb-2" value="{{ userr.Titre }}">

                    <input type="text" name="mDescription" class="form-control mb-2" value="{{ userr.Description }}">

                    <label for="mAffinites" id="mAffinites">Vos affinités (séparées par une virgule)</label>
                    <input type="text" name="mAffinites" id="mAffinites" class="form-control mb-2" value="{% for aff in userr.Affinites %}{{ aff }},{% endfor %}">


                </div>
                <hr>
            </div>
            <div class="container container-fluid">
                <div class=" mt-4 d-flex justify-content-between">
                    <div class="col-sm-4">
                        <label for="mSituation">Situation</label>
                        <select id="mSituation" name="mSituation" class="form-control">
                            {% set ListSituation = ["Célibataire", "En couple", "Marié", "Autre"] %}
                            {% for situation in ListSituation %}
                                <option {% if userr.Situation == situation %} selected {% endif %}>{{ situation }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-sm-4">
                        <label for="registerAge">Age</label>
                        <input type="number" id="registerAge" name="mAge" min="18" max="100" value="{{ userr.Age }}"
                               class="form-control" aria-describedby="warnAge">
                        <small id="warnAge" class="form-text text-muted">Personnes majeures uniquement.
                            &#128286;</small>
                    </div>


                    <div class="col-sm-4">
                        <label for="registerAttirance">Attirance</label>
                        <select id="registerAttirance" name="mAttirance" class="form-control">

                            {% set ListAttirance = ["Hétérosexuel", "Homosexuel", "Bisexuel", "Autre"] %}
                            {% for attirance in ListAttirance %}
                                <option {% if userr.Attirance == attirance %} selected {% endif %}>{{ attirance }}</option>
                            {% endfor %}

                        </select>
                    </div>
                </div>


                <hr>


                <div class=" mt-4 d-flex justify-content-between">
                    <div class="col-sm-8 form-group mb-3">
                        <label for="mVille">Ville</label>
                        <input type="text" class="form-control" id="mVille" name="mVille" value="{{ userr.Ville }}">

                    </div>


                    <div class="col-sm-4">
                        <label for="registerCampus">Campus</label>
                        <select id="registerCampus" name="mCampus" class="form-control">
                            {% set ListCampus = ["Madrillet", "Mont-Saint-Aignan", "Saint-Marc", "Pasteur", "UFR Santé", "Autre"] %}
                            {% for campus in ListCampus %}
                                <option {% if userr.Campus == campus %} selected {% endif %}>{{ campus }}</option>
                            {% endfor %}

                        </select>
                    </div>
                </div>
                <div class="mt-4 mb-3 d-flex justify-content-between">
                    <div class="col-sm-7 form-group">
                        <label for="mTelephone">Téléphone</label>
                        <input type="text" class="form-control" id="mTelephone" name="mTelephone"
                               value="{{ userr.Telephone }}">

                    </div>

                    <div class="col-sm-4 mb-2">
                        <input type="button" class="btn btn-outline-fmm" value="Localisation auto."
                               id="locationAutoBtn"/>
                    </div>

                    <span class="mb-2" id="locationTicked"></span>
                </div>
            </div>
        </div>

        <div class="mx-5">
            {% if userr.Photos is not null and userr.Photos is not empty %}
                <hr>
                {% for photo in userr.Photos %}

                    {% if loop.index0 is divisible by(3) %}
                        <div class="row mx-2 mb-4">
                    {% endif %}
                    <div class="col-lg-4">
                        <div class="wrapper-img-grid">
                            <label><img class="card-img-top"
                                        src="/uploads/images/{{ photo.PhotoDossier }}/{{ photo.PhotoName }}"
                                        alt="Photo de {{ userr.Prenom }}"></label>
                        </div>
                        <div class="input-group">

                            <div class="custom-file">
                                <input type="file" class="custom-file-input" name="photo{{ loop.index0 }}"
                                       id="photo{{ loop.index0 }}">
                                <label class="custom-file-label" for="photo{{ loop.index0 }}" width="6">Modifier
                                    l'image</label>
                            </div>
                        </div>

                    </div>
                    {% if loop.index0 is divisible by(3) and loop.index0 != 0 %}
                        </div>
                    {% endif %}

                {% endfor %}
            {% else %}
                <div class="display-4">Tu n'as pas de photos.</div>


            {% endif %}
            <div class="custom-file mt-3 mx-5 mb-5">
                <input type="file" class="custom-file-input" id="mAddPhoto" name="mAddPhoto">
                <label class="custom-file-label" for="mAddPhoto" width="6">Ajouter une image dans votre Galerie
                    photo</label>
            </div>

        </div>

        <input type="hidden" name="mLat" id="mLat" value="{{ userr.Latitude }}"/>
        <input type="hidden" name="mLong" id="mLong" value="{{ userr.Longitude }}"/>
        <input type="hidden" name="crsf" value={{ token }}>
    </form>
{% endblock %}

{% block js %}
    <script>

        $(document).ready(function () {
            $('#locationAutoBtn').click(function () {
                navigator.geolocation.getCurrentPosition(function (pos) {
                    let crd = pos.coords;
                    console.log('Votre position actuelle est :');
                    console.log(`Latitude : ${crd.latitude}`);
                    console.log(`Longitude : ${crd.longitude}`);
                    console.log(`La précision est de ${crd.accuracy} mètres.`);

                    $('#mLat').val(`${crd.latitude}`);
                    $('#mLong').val(`${crd.longitude}`);

                    $('#locationTicked').html('<i class="fas fa-check-circle"></i>');

                }, function (err) {
                    console.warn(`ERREUR (${err.code}): ${err.message}`);
                    $('#locationTicked').html('<i class="fas fa-exclamation-circle"></i>');

                }, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });


            });

            $('#mAddPhoto').on('change', function () {
                let fileName = document.getElementById("mAddPhoto").files[0].name;
                $('#mAddPhoto').addClass("selected").html(fileName);
            });

            $('#mProfilImg').on('change', function () {
                let fileName = document.getElementById("mProfilImg").files[0].name;
                $('#mProfilImg').addClass("selected").html(fileName);
            });
        });
    </script>
{% endblock %}